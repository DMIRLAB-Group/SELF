{
    "collab_server" : "",
    "contents" : "library(bnlearn)\nlibrary(compiler)\nlibrary(data.table)\n#setwd(\"C:/Users/35846/Documents/GitLab/R/Project/zheng_project\")\nsetwd(\"~/zhengproj/R/Project/zheng_project\")\nf<-function(x){\n  return(data.frame(x^2,x^3,x^4,sin(x),sin(x^2)))\n}\nsynthetic_data_nonlinear<-function(g,sample_num){\n  order<-node.ordering(g) #得到结点的排序\n  data<-matrix(0,nrow=sample_num,ncol=length(order))\n  colnames(data)<-order\n  pb <- txtProgressBar(0,length(order),style = 3)\n  for(i in 1:length(order)){\n    setTxtProgressBar(pb, i)\n    if(length(g[[order[i]]]$parents)==0){#先处理没父母的结点\n      data[,i]<-runif(sample_num,-1,1)\n    }else{\n      #处理有父母的结点\n      parents=g[[order[i]]]$parents\n      x=data[,parents,drop=F]\n      for(p in parents){\n        a=runif(5,-3,3)\n        b=rbinom(5,1,0.5)\n        b[round(runif(1,1,5))]<-1 #随机设一个位置为1，防止全为0\n        a=a[b==1]\n        data[,i]<-data[,i]+scale(t(t(a)%*%t(as.matrix(f(x[,p])[,b==1]))))\n      }\n      data[,i]<-data[,i]+runif(sample_num,-1,1)\n    }\n  }\n  return(as.data.frame(data))\n}\nsynthetic_data_nonlinear_discrete<-function(g,sample_num){\n  c=7 #force set to 5\n  order<-node.ordering(g) #得到结点的排序\n  data<-matrix(0,nrow=sample_num,ncol=length(order))\n  colnames(data)<-order\n  pb <- txtProgressBar(0,length(order),style = 3)\n  for(i in 1:length(order)){\n    setTxtProgressBar(pb, i)\n    if(length(g[[order[i]]]$parents)==0){#先处理没父母的结点\n      #data[,i]<-round(runif(sample_num,0,4))\n      #c=length(attr(g[[order[i]]]$prob,\"dimnames\")[[1]])\n      data[,i]<-round(abs(rnorm(sample_num,0,3)))%%c+1\n    }else{\n      #处理有父母的结点\n      parents=g[[order[i]]]$parents\n      x=data[,parents,drop=F]\n      for(p in parents){\n        a=runif(5,-3,3)\n        b=rbinom(5,1,0.5)\n        b[round(runif(1,1,5))]<-1 #随机设一个位置为1，防止全为0\n        a=a[b==1]\n        data[,i]<-data[,i]+t(t(a)%*%t(as.matrix(f(x[,p])[,b==1])))\n      }\n      #c=round(runif(1,3,5))\n      #c=length(attr(g[[order[i]]]$prob,\"dimnames\")[[1]])\n      data[,i]<-round(data[,i])%%c+round(rnorm(sample_num,0,1))\n      #data[,i]<-round(data[,i])%%c+round(runif(sample_num,0,c/2))\n      # data[,i]<-round(data[,i])%%c+1\n      # for(num in 0:(c-1)){\n      #   num_row=data[,i]==num\n      #   alpha=0.5\n      #   prob<-rep((1-alpha)/(c-1),c)\n      #   prob[num+1]<-alpha\n      #   data[num_row,i]<-data[num_row,i]+sample(0:(c-1)-num,sum(num_row),replace=T,prob=prob)\n      # }\n      #data[,i]<-(round(data[,i])+rpois(sample_num,0.4))%%c\n\n    }\n  }\n  return(as.data.frame(data))\n}\nsynthetic_data_nonlinear_discrete_old<-function(g,sample_num){\n  order<-node.ordering(g) #得到结点的排序\n  data<-matrix(0,nrow=sample_num,ncol=length(order))\n  colnames(data)<-order\n  pb <- txtProgressBar(0,length(order),style = 3)\n  for(i in 1:length(order)){\n    setTxtProgressBar(pb, i)\n    if(length(g[[order[i]]]$parents)==0){#先处理没父母的结点\n      data[,i]<-round(runif(sample_num,0,3))+1\n\n    }else{\n      #处理有父母的结点\n      parents=g[[order[i]]]$parents\n      x=data[,parents,drop=F]\n      data[,i]<-rowSums(x^2)%%3+round(runif(sample_num,0,3))\n      #data[,i]<-rowSums(x^2)%%4+rpois(sample_num,0.5)\n    }\n  }\n  return(as.data.frame(data))\n}\nsynthetic_data_linear<-function(g,sample_num,rate=1){\n  order<-node.ordering(g) #得到结点的排序\n  data<-matrix(0,nrow=sample_num,ncol=length(order))\n  colnames(data)<-order\n  pb <- txtProgressBar(0,length(order),style = 3)\n  for(i in 1:length(order)){\n    setTxtProgressBar(pb, i)\n    if(length(g[[order[i]]]$parents)==0){#先处理没父母的结点\n      data[,i]<-runif(sample_num,-1,1)\n      #data[,i]<-rnorm(sample_num,-1,1)\n    }else{\n      #处理有父母的结点\n      parents=g[[order[i]]]$parents\n      x=data[,parents,drop=F]\n      a=runif(length(parents)+1,0.5,1)\n      b=rbinom(length(parents)+1,2,0.5)\n      b[b==0]=-1\n      a=a*b\n      x=data.frame(x,c=1) #截距项\n      data[,i]<-as.matrix(x)%*%a+runif(sample_num,-1,1)*rate\n\n      # parents=g[[order[i]]]$parents\n      # x=data[,parents,drop=F]\n      # a=runif(length(parents),0.5,1)\n      # b=rbinom(length(parents),2,0.5)\n      # b[b==0]=-1\n      # a=a*b\n      #\n      # data[,i]<-as.matrix(x)%*%a+runif(sample_num,-1,1)*rate\n    }\n  }\n  return(as.data.frame(data))\n}\nsynthetic_data_discrete<-function(g,sample_num){\n  #基本思路：\n  #1.产生一个idx to value的映射\n  #2.两个变量按照变量取值分组，如果两个取值相同就分到同一组\n  #3.用行号作为id\n  #4.从而产生所有label\n  order<-node.ordering(g) #得到结点的排序\n  data<-matrix(0,nrow=sample_num,ncol=length(order))\n  colnames(data)<-order\n  pb <- txtProgressBar(0,length(order),style = 3)\n  for(i in 1:length(order)){\n    setTxtProgressBar(pb, i)\n    if(length(g[[order[i]]]$parents)==0){#先处理没父母的结点\n      p=(0.8*runif(1)+0.1)\n      data[,i]<-rgeom(sample_num,p)\n    }else{\n      #处理有父母的结点\n      parents=g[[order[i]]]$parents\n      x=data[,parents,drop=F]\n      x=as.data.table(x)\n      x[,g:=.GRP,by=names(x)]\n      fct=sample.int(15,max(x$g),replace = T)-8\n      tmp=sample.int(5,1) #随机产生1到5的数，如果tmp=2 就相当于产生-2,-1,0,1,2的噪声。\n      length=2*tmp+1;\n      n_rand=c(0,sort(runif(length-1)),1) #产生的思路是将0,1随机划分成5段，然后diff一下就得到了每个噪声的分布了\n      p_n=diff(n_rand)\n      n_values=((-tmp):tmp)\n      #eps=sample(x = n_values, sample_num, replace = T, prob = p_n)\n      eps=0\n      data[,i]<-fct[x$g]+eps\n    }\n  }\n  return(as.data.frame(data))\n}\n#非线性数据产生-----\n# g<-read.net(\"alarm.net\")\n# set.seed(0)\n# data<-synthetic_data_nonlinear(g,1000)\n# fwrite(data,\"data/alarm1000_nonlinear.csv\")\n# set.seed(1)\n# data<-synthetic_data_nonlinear(g,2000)\n# fwrite(data,\"data/alarm2000_nonlinear.csv\")\n# set.seed(2)\n# data<-synthetic_data_nonlinear(g,4000)\n# fwrite(data,\"data/alarm4000_nonlinear.csv\")\n#\n#\n# g<-read.net(\"child.net\")\n# set.seed(0)\n# data<-synthetic_data_nonlinear(g,1000)\n# fwrite(data,\"data/child1000_nonlinear.csv\")\n# set.seed(1)\n# data<-synthetic_data_nonlinear(g,2000)\n# fwrite(data,\"data/child2000_nonlinear.csv\")\n# set.seed(2)\n# data<-synthetic_data_nonlinear(g,4000)\n# fwrite(data,\"data/child4000_nonlinear.csv\")\n#\n# g<-read.net(\"win95pts.net\")\n# set.seed(0)\n# data<-synthetic_data_nonlinear(g,1000)\n# fwrite(data,\"data/win95pts1000_nonlinear.csv\")\n# set.seed(1)\n# data<-synthetic_data_nonlinear(g,2000)\n# fwrite(data,\"data/win95pts2000_nonlinear.csv\")\n# set.seed(2)\n# data<-synthetic_data_nonlinear(g,4000)\n# fwrite(data,\"data/win95pts4000_nonlinear.csv\")\n\n#离散数据产生------\n\n# g<-read.net(\"alarm.net\")\n# set.seed(0)\n# data<-synthetic_data_nonlinear_discrete(g,1000)\n# fwrite(data,\"data/alarm1000_nonlinear_discrete_new.csv\")\n# set.seed(1)\n# data<-synthetic_data_nonlinear_discrete(g,2000)\n# fwrite(data,\"data/alarm2000_nonlinear_discrete_new.csv\")\n# set.seed(2)\n# data<-synthetic_data_nonlinear_discrete(g,4000)\n# fwrite(data,\"data/alarm4000_nonlinear_discrete_new.csv\")\n#\n# g<-read.net(\"win95pts.net\")\n# set.seed(0)\n# data<-synthetic_data_nonlinear_discrete(g,1000)\n# fwrite(data,\"data/win95pts1000_nonlinear_discrete_new.csv\")\n# set.seed(1)\n# data<-synthetic_data_nonlinear_discrete(g,2000)\n# fwrite(data,\"data/win95pts2000_nonlinear_discrete_new.csv\")\n# set.seed(2)\n# data<-synthetic_data_nonlinear_discrete(g,4000)\n# fwrite(data,\"data/win95pts4000_nonlinear_discrete_new.csv\")\n#\n# g<-read.net(\"child.net\")\n# set.seed(0)\n# data<-synthetic_data_nonlinear_discrete(g,1000)\n# fwrite(data,\"data/child1000_nonlinear_discrete_new.csv\")\n# set.seed(1)\n# data<-synthetic_data_nonlinear_discrete(g,2000)\n# fwrite(data,\"data/child2000_nonlinear_discrete_new.csv\")\n# set.seed(2)\n# data<-synthetic_data_nonlinear_discrete(g,4000)\n# fwrite(data,\"data/child4000_nonlinear_discrete_new.csv\")\n#\n# g<-read.net(\"child.net\")\n# set.seed(0)\n# data<-synthetic_data_nonlinear_discrete_old(g,1000)\n# fwrite(data,\"data/child1000_nonlinear_discrete_new.csv\")\n# set.seed(1)\n# data<-synthetic_data_nonlinear_discrete_old(g,2000)\n# fwrite(data,\"data/child2000_nonlinear_discrete_new.csv\")\n# set.seed(2)\n# data<-synthetic_data_nonlinear_discrete_old(g,4000)\n# fwrite(data,\"data/child4000_nonlinear_discrete_new.csv\")\n\n#线性数据产生-----\n# g<-read.net(\"alarm.net\")\n# set.seed(0)\n# data<-synthetic_data_linear(g,1000)\n# fwrite(data,\"data/alarm1000_linear.csv\")\n# set.seed(1)\n# data<-synthetic_data_linear(g,2000)\n# fwrite(data,\"data/alarm2000_linear.csv\")\n# set.seed(2)\n# data<-synthetic_data_linear(g,4000)\n# fwrite(data,\"data/alarm4000_linear.csv\")\n#\n# g<-read.net(\"win95pts.net\")\n# set.seed(0)\n# data<-synthetic_data_linear(g,1000)\n# fwrite(data,\"data/win95pts1000_linear.csv\")\n# set.seed(1)\n# data<-synthetic_data_linear(g,2000)\n# fwrite(data,\"data/win95pts2000_linear.csv\")\n# set.seed(2)\n# data<-synthetic_data_linear(g,4000)\n# fwrite(data,\"data/win95pts4000_linear.csv\")\n#\n# g<-read.net(\"child.net\")\n# set.seed(0)\n# data<-synthetic_data_linear(g,1000)\n# fwrite(data,\"data/child1000_linear.csv\")\n# set.seed(1)\n# data<-synthetic_data_linear(g,2000)\n# fwrite(data,\"data/child2000_linear.csv\")\n# set.seed(2)\n# data<-synthetic_data_linear(g,4000)\n# fwrite(data,\"data/child4000_linear.csv\")\n#\n# #线性数据产生2-----\n# g<-read.net(\"alarm.net\")\n# set.seed(0)\n# data<-synthetic_data_linear(g,1000,rate=0.1)\n# fwrite(data,\"data/alarm1000_linear_rate0_1.csv\")\n# set.seed(1)\n# data<-synthetic_data_linear(g,2000,rate=0.1)\n# fwrite(data,\"data/alarm2000_linear_rate0_1.csv\")\n# set.seed(2)\n# data<-synthetic_data_linear(g,4000,rate=0.1)\n# fwrite(data,\"data/alarm4000_linear_rate0_1.csv\")\n#\n# g<-read.net(\"win95pts.net\")\n# set.seed(0)\n# data<-synthetic_data_linear(g,1000,rate=0.1)\n# fwrite(data,\"data/win95pts1000_linear_rate0_1.csv\")\n# set.seed(1)\n# data<-synthetic_data_linear(g,2000,rate=0.1)\n# fwrite(data,\"data/win95pts2000_linear_rate0_1.csv\")\n# set.seed(2)\n# data<-synthetic_data_linear(g,4000,rate=0.1)\n# fwrite(data,\"data/win95pts4000_linear_rate0_1.csv\")\n#\n# g<-read.net(\"child.net\")\n# set.seed(0)\n# data<-synthetic_data_linear(g,1000,rate=0.1)\n# fwrite(data,\"data/child1000_linear_rate0_1.csv\")\n# set.seed(1)\n# data<-synthetic_data_linear(g,2000,rate=0.1)\n# fwrite(data,\"data/child2000_linear_rate0_1.csv\")\n# set.seed(2)\n# data<-synthetic_data_linear(g,4000,rate=0.1)\n# fwrite(data,\"data/child4000_linear_rate0_1.csv\")\n#\n# #线性数据生成3--------\n# g<-read.net(\"alarm.net\")\n# set.seed(0)\n# data<-synthetic_data_linear(g,1000)\n# fwrite(data,\"data/alarm1000_linear_norm.csv\")\n# set.seed(1)\n# data<-synthetic_data_linear(g,2000)\n# fwrite(data,\"data/alarm2000_linear_norm.csv\")\n# set.seed(2)\n# data<-synthetic_data_linear(g,4000)\n# fwrite(data,\"data/alarm4000_linear_norm.csv\")\n#\n# g<-read.net(\"win95pts.net\")\n# set.seed(0)\n# data<-synthetic_data_linear(g,1000)\n# fwrite(data,\"data/win95pts1000_linear_norm.csv\")\n# set.seed(1)\n# data<-synthetic_data_linear(g,2000)\n# fwrite(data,\"data/win95pts2000_linear_norm.csv\")\n# set.seed(2)\n# data<-synthetic_data_linear(g,4000)\n# fwrite(data,\"data/win95pts4000_linear_norm.csv\")\n#\n# g<-read.net(\"child.net\")\n# set.seed(0)\n# data<-synthetic_data_linear(g,1000)\n# fwrite(data,\"data/child1000_linear_norm.csv\")\n# set.seed(1)\n# data<-synthetic_data_linear(g,2000)\n# fwrite(data,\"data/child2000_linear_norm.csv\")\n# set.seed(2)\n# data<-synthetic_data_linear(g,4000)\n# fwrite(data,\"data/child4000_linear_norm.csv\")\n#\n# #离散数据产生c=5------\n#\n# g<-read.net(\"alarm.net\")\n# set.seed(0)\n# data<-synthetic_data_nonlinear_discrete(g,1000)\n# fwrite(data,\"data/alarm1000_nonlinear_discrete_c5.csv\")\n# set.seed(1)\n# data<-synthetic_data_nonlinear_discrete(g,2000)\n# fwrite(data,\"data/alarm2000_nonlinear_discrete_c5.csv\")\n# set.seed(2)\n# data<-synthetic_data_nonlinear_discrete(g,4000)\n# fwrite(data,\"data/alarm4000_nonlinear_discrete_c5.csv\")\n#\n# g<-read.net(\"win95pts.net\")\n# set.seed(0)\n# data<-synthetic_data_nonlinear_discrete(g,1000)\n# fwrite(data,\"data/win95pts1000_nonlinear_discrete_c5.csv\")\n# set.seed(1)\n# data<-synthetic_data_nonlinear_discrete(g,2000)\n# fwrite(data,\"data/win95pts2000_nonlinear_discrete_c5.csv\")\n# set.seed(2)\n# data<-synthetic_data_nonlinear_discrete(g,4000)\n# fwrite(data,\"data/win95pts4000_nonlinear_discrete_c5.csv\")\n#\n# g<-read.net(\"child.net\")\n# set.seed(0)\n# data<-synthetic_data_nonlinear_discrete(g,1000)\n# fwrite(data,\"data/child1000_nonlinear_discrete_c5.csv\")\n# set.seed(1)\n# data<-synthetic_data_nonlinear_discrete(g,2000)\n# fwrite(data,\"data/child2000_nonlinear_discrete_c5.csv\")\n# set.seed(2)\n# data<-synthetic_data_nonlinear_discrete(g,4000)\n# fwrite(data,\"data/child4000_nonlinear_discrete_c5.csv\")\n#\n# g<-read.net(\"child.net\")\n# set.seed(0)\n# data<-synthetic_data_nonlinear_discrete_old(g,1000)\n# fwrite(data,\"data/child1000_nonlinear_discrete_c5.csv\")\n# set.seed(1)\n# data<-synthetic_data_nonlinear_discrete_old(g,2000)\n# fwrite(data,\"data/child2000_nonlinear_discrete_c5.csv\")\n# set.seed(2)\n# data<-synthetic_data_nonlinear_discrete_old(g,4000)\n# fwrite(data,\"data/child4000_nonlinear_discrete_c5.csv\")\n#\n# #离散数据产生映射版-----\n# g<-read.net(\"alarm.net\")\n# set.seed(0)\n# data<-synthetic_data_discrete(g,1000)\n# fwrite(data,\"data/alarm1000_discrete_map.csv\")\n# set.seed(1)\n# data<-synthetic_data_discrete(g,2000)\n# fwrite(data,\"data/alarm2000_discrete_map.csv\")\n# set.seed(2)\n# data<-synthetic_data_discrete(g,4000)\n# fwrite(data,\"data/alarm4000_discrete_map.csv\")\n#\n# g<-read.net(\"win95pts.net\")\n# set.seed(0)\n# data<-synthetic_data_discrete(g,1000)\n# fwrite(data,\"data/win95pts1000_discrete_map.csv\")\n# set.seed(1)\n# data<-synthetic_data_discrete(g,2000)\n# fwrite(data,\"data/win95pts2000_discrete_map.csv\")\n# set.seed(2)\n# data<-synthetic_data_discrete(g,4000)\n# fwrite(data,\"data/win95pts4000_discrete_map.csv\")\n#\n# g<-read.net(\"child.net\")\n# set.seed(0)\n# data<-synthetic_data_discrete(g,1000)\n# fwrite(data,\"data/child1000_discrete_map.csv\")\n# set.seed(1)\n# data<-synthetic_data_discrete(g,2000)\n# fwrite(data,\"data/child2000_discrete_map.csv\")\n# set.seed(2)\n# data<-synthetic_data_discrete(g,4000)\n# fwrite(data,\"data/child4000_discrete_map.csv\")\n#\n\n",
    "created" : 1508243269823.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1452944079",
    "id" : "256343A0",
    "lastKnownWriteTime" : 1493793875,
    "last_content_update" : 1493793875,
    "path" : "~/zhengproj/R/Project/zheng_project/synthetic_data.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 18,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}